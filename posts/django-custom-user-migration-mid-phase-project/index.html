<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=yandex-verification content="3ccce49727df78e2"><title>Django: Changing User Model in Mid-Project</title><meta name=description content="How can we change User Model in Mid-Project for Django. Also discussion about a common error- ValueError: Related model app.User cannot be resolved."><link rel=preload href=/fonts/pt-serif-400-i-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-i-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-i-cyrillic.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-cyrillic.woff2 as=font><link rel=preload href=/fonts/pt-serif-400-i-cyrillic.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-cyrillic.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-i-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-i-cyrillic.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-i-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-latin.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-i-latin.woff2 as=font><link rel=preload href=/fonts/pt-serif-400-latin.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-i-cyrillic.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-i-latin.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-latin.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-i-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-400-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-latin.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-i-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-400-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-latin-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-400-i-latin.woff2 as=font><link rel=preload href=/fonts/pt-sans-700-i-latin.woff2 as=font><link rel=preload href=/fonts/pt-serif-400-i-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-sans-400-cyrillic.woff2 as=font><link rel=preload href=/fonts/pt-serif-700-i-cyrillic-ext.woff2 as=font><link rel=preload href=/fonts/pt-serif-400-cyrillic.woff2 as=font><link rel=stylesheet href=https://ruddra.com/css/bundle.min.29d1885acc2be788f6b64355dfcc4c94ef558aa090360bc7a13a9e8e16514506.css integrity="sha256-KdGIWswr54j2tkNV38xMlO9ViqCQNgvHoTqejhZRRQY=" async><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon.png><link rel="shortcut icon" href=/favicon.ico><link rel=alternate type=application/rss+xml title=RSS href=/sitemap.xml><meta name=generator content="Hugo 0.64.0"><meta name=twitter:card content="summary_large_image"><meta name=robots content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="Ruddra.com | Blog by Arnab Kumar Shil"><meta property="article:publisher" content="https://ruddra.com"><meta property="article:section" content="Bulletin"><meta property="article:published_time" content="2019-01-03T00:00:00.00Z"><meta property="article:modified_time" content="2020-02-15T00:00:00.00Z"><meta property="og:updated_time" content="2020-02-15T00:00:00.00Z"><meta property="og:image" content="https://ruddra.com/content/images/2019/01/django-user-override.jpg"><meta property="og:image:secure_url" content="https://ruddra.com/content/images/2019/01/django-user-override.jpg"><meta property="og:image:width" content="720"><meta property="og:image:height" content="350"><meta name=twitter:title content="Django: Changing User Model in Mid-Project"><meta name=twitter:description content="How can we change User Model in Mid-Project for Django. Also discussion about a common error- ValueError: Related model app.User cannot be resolved."><meta property="og:type" content="article"><meta property="og:title" content="Django: Changing User Model in Mid-Project"><meta property="og:description" content="How can we change User Model in Mid-Project for Django. Also discussion about a common error- ValueError: Related model app.User cannot be resolved."><meta name=twitter:image content="https://ruddra.com/content/images/2019/01/django-user-override.jpg"><meta property="og:image" content="https://ruddra.com/content/images/2019/01/django-user-override.jpg"><meta property="article:tag" content="django"><meta property="article:tag" content="migration"><meta property="article:tag" content="models"><meta property="article:tag" content="ruddra"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"posts","mainEntityOfPage":"https:\/\/ruddra.com\/posts\/django-custom-user-migration-mid-phase-project\/","identifier":"https:\/\/ruddra.com\/posts\/django-custom-user-migration-mid-phase-project\/","author":{"@type":"Person","name":"Arnab Kumar Shil","url":"https:\/\/ruddra.com/info/about/"},"logo":"https:\/\/ruddra.com\/favicon-32x32.png","name":"Django: Changing User Model in Mid-Project","headline":"Django: Changing User Model in Mid-Project","description":"How can we change User Model in Mid-Project for Django. Also discussion about a common error- ValueError: Related model app.User cannot be resolved.","inLanguage":"en-US","creator":["Arnab Kumar Shil"],"accountablePerson":"Arnab Kumar Shil","copyrightHolder":"Arnab Kumar Shil","copyrightYear":"2019","dateCreated":"2019-01-03T00:00:00.00Z","datePublished":"2019-01-03T00:00:00.00Z","dateModified":"2020-02-15T00:00:00.00Z","url":"https:\/\/ruddra.com\/posts\/django-custom-user-migration-mid-phase-project\/","wordCount":"541","publisher":{"@type":"Organization","name":"Ruddra.com | Blog by Arnab Kumar Shil","url":"https:\/\/ruddra.com","logo":"https:\/\/ruddra.com\/avatar.png"},"image":["https:\/\/ruddra.com\/content\/images\/2019\/01\/django-user-override.jpg"],"keywords":["Tag:Django","Tag:Migration","Tag:Models","Elevated:true","Tag:Blog"]}</script></head><body><div id=cover-spin></div><input type=checkbox class=sidebar-checkbox id=sidebar-checkbox><div class=sidebar id=sidebar><div class=sidebar-item><img src=/avatar.jpg decoding=async loading=lazy><p>Hi! I am Arnab, a full stack developer specializing in <b><a href=/tags/python/>Python</a></b>,
<b><a href=/tags/django/>Django</a></b>, <b><a href=/tags/docker/>Docker</a></b>, <b><a href=/tags/reactjs/>React</a></b>, <b><a href=/tags/openshift/>OpenShift</a></b>.</p><p class=sidebar-icons><a class=icon-side-bar href=https://stackoverflow.com/users/2696165/ruddra target=_blank rel="noopener me" title=stackoverflow><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="10 10 100 100" fill="currentcolor" class="feather"><path d="M84.4 93.8V70.6h7.7v30.9H22.6V70.6h7.7v23.2z"/><path d="M38.8 68.4l37.8 7.9 1.6-7.6-37.8-7.9-1.6 7.6zm5-18 35 16.3 3.2-7-35-16.4-3.2 7.1zm9.7-17.2 29.7 24.7 4.9-5.9-29.7-24.7-4.9 5.9zm19.2-18.3-6.2 4.6 23 31 6.2-4.6-23-31zM38 86h38.6v-7.7H38V86z"/></svg></a><a class=icon-side-bar href=https://github.com/ruddra target=_blank rel="noopener me" title=github><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a><a class=icon-side-bar href=https://www.linkedin.com/in/ruddraarnab target=_blank rel="noopener me" title=linkedin><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a class=icon-side-bar href=https://medium.com/@ruddra target=_blank rel="noopener me" title=medium><svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><rect id="backgroundrect" width="100%" height="100%" x="0" y="0" fill="none" stroke="none"/><g class="currentLayer"><title>Layer 1</title><path d="M2.846 6.887c.03-.295-.083-.586-.303-.784l-2.24-2.7v-.403h6.958l5.378 11.795 4.728-11.795h6.633v.403l-1.916 1.837c-.165.126-.247.333-.213.538v13.498c-.034.204.048.411.213.537l1.871 1.837v.403h-9.412v-.403l1.939-1.882c.19-.19.19-.246.19-.537v-10.91l-5.389 13.688h-.728l-6.275-13.688v9.174c-.052.385.076.774.347 1.052l2.521 3.058v.404h-7.148v-.404l2.521-3.058c.27-.279.39-.67.325-1.052v-10.608z" id="svg_1" class="selected" opacity="1" fill="#fff" fill-opacity="1"/></g></svg></a><a class=icon-side-bar href=/posts/index.xml target=_blank rel="noopener me" title=rss><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></p></div><nav class=sidebar-nav><a class=sidebar-nav-item href=/>Home</a>
<a class=sidebar-nav-item href=/info/about/>About
Me</a>
<a class=sidebar-nav-item href=/info/privacy/>Privacy Policy</a><form class="sidebar-nav-item search-form" method=get action=/search><input type=text class=tftextinput name=q size=21 maxlength=120><button type=submit class=tfbutton><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="rgb(155,155,155)"><path d="M9.145 18.29c-5.042.0-9.145-4.102-9.145-9.145S4.103.0 9.145.0s9.145 4.103 9.145 9.145-4.102 9.145-9.145 9.145zm0-15.167c-3.321.0-6.022 2.702-6.022 6.022s2.702 6.022 6.022 6.022 6.023-2.702 6.023-6.022-2.702-6.022-6.023-6.022zm9.263 12.443c-.817 1.176-1.852 2.188-3.046 2.981l5.452 5.453 3.014-3.013-5.42-5.421z" /></svg></button></form></nav><div class=sidebar-item><p>&copy; 2020. All rights reserved.</p></div></div><div id=snackbar>By using our website, you agree to our <a href=/privacy>privacy policy</a> <a id=close-privacy>&#x2715;</a></div><div class=wrap><div class=masthead><div class=container><h3 class=masthead-title><a href=/ title=Home style=color:#cfcdcd>Ruddra</a><small style=color:#838383;font-size:1.25rem>.com</small></h3><form class="masthead-search-form pull-right" method=get action=/search><input type=text class=tftextinput name=q size=21 maxlength=120><button type=submit class=tfbutton><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="rgb(155,155,155)"><path d="M9.145 18.29c-5.042.0-9.145-4.102-9.145-9.145S4.103.0 9.145.0s9.145 4.103 9.145 9.145-4.102 9.145-9.145 9.145zm0-15.167c-3.321.0-6.022 2.702-6.022 6.022s2.702 6.022 6.022 6.022 6.023-2.702 6.023-6.022-2.702-6.022-6.023-6.022zm9.263 12.443c-.817 1.176-1.852 2.188-3.046 2.981l5.452 5.453 3.014-3.013-5.42-5.421z"/></svg></button></form></div></div><div class=progress-container><div class=progress-bar id=myBar></div></div><div class="container content"><div class=post><h1 class=post-title>Django: Changing User Model in Mid-Project</h1><span class=post-date>Jan 3, 2019 &#183; 3 min read &#183;
6 comments</span><div class=img-container><img class=img-center src=https://ruddra.com/content/images/2019/01/django-user-override.jpg alt="Django: Changing User Model in Mid-Project"></div><p>Every now and then I see some questions pop up in StackOverflow with title:</p><blockquote><p>ValueError: Related model &lsquo;app.User&rsquo; cannot be resolved</p></blockquote><p>This is a very common issue and pops up when the user tries to run the migration. So, lets talk more about what is this problem and how can we solve it.<div class=toc><h2 class=toc>Table of contents</h2><nav id=TableOfContents><ul><li><a href=#the-problem>The problem</a></li><li><a href=#why-it-occurs>Why It occurs</a></li><li><a href=#how-to-resolve-it>How to resolve it</a><ul><li><a href=#easy-way>Easy way</a></li><li><a href=#hard-way>Hard Way</a></li><li><a href=#alternative-way>Alternative way</a></li></ul></li><li><a href=#for-future-projects>For future projects</a></li><li><a href=#in-conclusion>In conclusion</a></li></ul></nav></div><div></p><h2 id=the-problem>The problem<a href=#the-problem class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h2><p>This error occurs when you have been using Django&rsquo;s default User model, and in mid project, you need some changes in <strong>auth.User</strong> model and decided to use <a href=https://docs.djangoproject.com/en/2.1/topics/auth/customizing/#substituting-a-custom-user-model>CustomUser</a>.</p><h2 id=why-it-occurs>Why It occurs<a href=#why-it-occurs class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h2><p>As per <a href=https://docs.djangoproject.com/en/2.1/topics/auth/customizing/#changing-to-a-custom-user-model-mid-project>documentation</a>:</p><blockquote><p>Changing AUTH_USER_MODEL after you’ve created database tables is significantly more difficult since it affects foreign keys and many-to-many relationship.</p></blockquote><p>As <strong>auth.User</strong> is core part of Django, and when you change the tables, it can&rsquo;t work properly. This problem is hard to identify even for myself, because of the error it throws due to migration.</p><h2 id=how-to-resolve-it>How to resolve it<a href=#how-to-resolve-it class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h2><h3 id=easy-way>Easy way<a href=#easy-way class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h3><p>The easiest(and cleanest) way is to delete all your migration files from all apps, drop the database. Then create a new database and connect your project to that. Then run <code>python manage.py makemigrations</code> and <code>python manage.py migrate</code> to make changes in DB. Means to make a clean start for the project, data wise.</p><h3 id=hard-way>Hard Way<a href=#hard-way class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h3><p>Dropping the Database is not always possible for us. So there is an another approach to resolve this issue(based on ticket <a href=https://code.djangoproject.com/ticket/25313>#25313</a>):</p><ol><li><p>Create a custom user model identical to <strong>auth.User</strong>, call it <code>User</code> (so many-to-many tables keep the same name) and set <code>db_table='auth_user'</code> (so it uses the same table). Like this:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>django.contrib.auth.models</span> <span class=kn>import</span> <span class=n>AbstractUser</span>

<span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>AbstractUser</span><span class=p>)</span><span class=p>:</span>
    <span class=k>class</span> <span class=nc>Meta</span><span class=p>:</span>
        <span class=n>db_table</span><span class=o>=</span><span class=sa></span><span class=s1>&#39;</span><span class=s1>auth_user</span><span class=s1>&#39;</span>
</code></pre></div></li><li><p>Throw away all your <em>migrations</em> from all the apps(except for <code>__init__.py</code> file inside the migrations folder).</p></li><li><p>Now update value of <code>AUTH_USER_MODEL</code> in your <strong>settings.py</strong> with <code>myapp.User</code>(Custom User Model) like <code>AUTH_USER_MODEL = 'myapp.User'</code>.</p></li><li><p>Recreate a fresh set of migrations using <code>python manage.py makemigrations</code>.</p></li><li><p>Make a backup of your database.</p></li><li><p>Delete all entries from <code>django_migrations</code> table.</p></li><li><p>Fake-apply the new set of migrations using <code>python manage.py migrate --fake</code>.</p></li><li><p><em>Optional:</em> Set <code>db_table="your_custom_table"</code> or remove it altogether.</p></li><li><p>Make other changes to the custom model, generate migrations, apply them.</p></li></ol><h3 id=alternative-way>Alternative way<a href=#alternative-way class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h3><p>You can take a different approach rather than overriding you <strong>auth.User</strong> model. You can define a new model(lets say <strong>Profile</strong>), and put your relevant fields there. Then, make a <a href=https://docs.djangoproject.com/en/2.1/topics/db/examples/one_to_one/>OneToOne</a> relation with <strong>auth.User</strong> like this:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=k>class</span> <span class=nc>Profile</span><span class=p>(</span><span class=n>models</span><span class=o>.</span><span class=n>Model</span><span class=p>)</span><span class=p>:</span>
    <span class=n>user</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>OneToOneField</span><span class=p>(</span><span class=n>User</span><span class=p>)</span>
    <span class=n>some_field</span> <span class=o>=</span> <span class=n>models</span><span class=o>.</span><span class=n>CharField</span><span class=p>(</span><span class=n>max_length</span><span class=o>=</span><span class=mi>255</span><span class=p>,</span> <span class=n>null</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>blank</span><span class=o>=</span><span class=bp>True</span><span class=p>,</span> <span class=n>default</span><span class=o>=</span><span class=bp>None</span><span class=p>)</span>
</code></pre></div><p>You can use <a href=https://docs.djangoproject.com/en/2.1/ref/signals/#post-save>post_save</a> signals to create a profile automatically every time a User is created.</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=kn>from</span> <span class=nn>django.dispatch</span> <span class=kn>import</span> <span class=n>receiver</span>
<span class=kn>from</span> <span class=nn>django.core.signals</span> <span class=kn>import</span> <span class=n>post_save</span>
<span class=kn>from</span> <span class=nn>django.contrib.auth.models</span> <span class=kn>import</span> <span class=n>User</span>

<span class=nd>@receiver</span><span class=p>(</span><span class=n>post_save</span><span class=p>,</span> <span class=n>sender</span><span class=o>=</span><span class=n>User</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>create_user_profile</span><span class=p>(</span><span class=n>sender</span><span class=p>,</span> <span class=n>instance</span><span class=o>=</span><span class=bp>None</span><span class=p>,</span> <span class=n>created</span><span class=o>=</span><span class=bp>None</span><span class=p>,</span> <span class=o>*</span><span class=o>*</span><span class=n>kwargs</span><span class=p>)</span><span class=p>:</span>
    <span class=k>if</span> <span class=n>created</span><span class=p>:</span>
        <span class=n>Profile</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=n>user</span><span class=o>=</span><span class=n>instance</span><span class=p>)</span>
</code></pre></div><p>You can use this easily in python:</p><div class=highlight><pre class=chroma><code class=language-python data-lang=python><span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>first</span><span class=p>(</span><span class=p>)</span>
<span class=n>user</span><span class=o>.</span><span class=n>profile</span><span class=o>.</span><span class=n>some_field</span>  <span class=c1># Thus you get value of some field from Profile</span>
<span class=c1># OR</span>
<span class=n>profile</span> <span class=o>=</span> <span class=n>Profile</span><span class=o>.</span><span class=n>objects</span><span class=o>.</span><span class=n>first</span><span class=p>(</span><span class=p>)</span>
<span class=n>user</span> <span class=o>=</span> <span class=n>profile</span><span class=o>.</span><span class=n>user</span>  <span class=c1># Thus you get auth.User</span>
</code></pre></div><p>Or in template:</p><div class=highlight><pre class=chroma><code class=language-django data-lang=django><span class=cp>{{</span> <span class=nv>user</span><span class=nv>.profile</span><span class=nv>.some_field</span> <span class=cp>}}</span><span class=x>
</span></code></pre></div><p><em>FYI:</em> this process was mentioned in the <a href=https://docs.djangoproject.com/en/2.1/topics/auth/customizing/#extending-the-existing-user-model>documentation</a> as well.</p><h2 id=for-future-projects>For future projects<a href=#for-future-projects class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h2><p>For future projects, you should use your <strong>CustomUser</strong> model from the beginning. It will reduce a lot of hassle when it comes to customizing <strong>User</strong>.</p><h2 id=in-conclusion>In conclusion<a href=#in-conclusion class=hanchor arialabel=Anchor> <svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg>&#xFE0E;</a></h2><p>To Be Honest, this an old problem and there is no good way to resolve it(at least not in Django 2.1). Hopefully in future releases, it will be fixed.</p></div><br><p><a class=tag-class href=/tags/django>Django</a> <a class=tag-class href=/tags/migration>Migration</a> <a class=tag-class href=/tags/models>Models</a></p><div class=newsletter-section id=newsletter-submitted><h2>Get Better With Django</h2><div id=commento class="commento-root commento-root-font"><div id=newsletter-error class=commento-error-box style=display:none>An error occurred when submitting the form, please try again.</div><div id=newsletter-submitted-box style=display:none><p class=newsletter-submitted-txt>Thank you for your subscription to our newsletters.<br>You will start receiving emails from next iteration.</p></div><div id=newsletter-body><div>Subscribe to get monthly articles about Django and more.<br>We won't spam you. Unsubscribe at any time.</div><br><div id=commento-main-area class=commento-main-area><form id=commento-form method=post action=https://ruddra-comments.herokuapp.com/v2/entry/ruddra/ruddra.comments/master/comments><input type=hidden name=options[redirect] value=https://ruddra.com/posts/django-custom-user-migration-mid-phase-project/#newsletter-submitted>
<input type=hidden name=options[slug] value=newsletter-subscription>
<input type=hidden name=options[parent] value=newsletter-subscription>
<input type=hidden name=options[origin] value=https://ruddra.com/newsletters/>
<input type=hidden name=options[redirectError] value=https://ruddra.com/posts/django-custom-user-migration-mid-phase-project/#newsletter-error><div id=commento-login class=commento-login><input type=email name=fields[email] placeholder="Your email address" style="padding-left:10px;width:90%;line-height:2;border:1px solid rgba(50,50,93,.1)" required></div><div style=width:95.8%><button id=commento-submit-button-root type=submit class="commento-button commento-submit-button">Subscribe</button><div class="commento-round-check commento-anonymous-checkbox-container"><input id=commento-checkbox-root name=options[subscribe] type=checkbox value=email required><label for=commento-checkbox-root>I agree to receive
emails</label></div></div></form></div></div></div></div><div class=pagination><div class="pagination-item older"><span class=pagination-arrow>&#8592; Previous</span><div class=pagination-link><a href=https://ruddra.com/posts/tdd-drf-factory-boy-faker/>Testing for Django Rest Framework with Factory Boy and Faker</a></div><div class=pagination-image><img src=https://ruddra.com/content/images/2019/01/django-factory-boy.jpg alt="Testing for Django Rest Framework with Factory Boy and Faker"></div><p class=pagination-text>“I&rsquo;m not a great programmer; I&rsquo;m just a good programmer with great habits.” ― Kent Beck
Test Driven …</p></div><div class="pagination-item newer"><span class=pagination-arrow>Next &#8594;</span><div class=pagination-link><a href=https://ruddra.com/posts/django-model-linked-list/>Django: Ordering by Linked List for Model Objects</a></div><div class=pagination-image><img src=https://ruddra.com/content/images/2019/08/linked_list.jpg alt="Django: Ordering by Linked List for Model Objects" decoding=async loading=lazy></div><p class=pagination-text>Linked list is a data structure where each object has points to next. In django, linked list can provide an interesting …</p></div></div><div class=tiny id=comment-submitted><div id=commento class="commento-root commento-root-font"><div id=comment-submitted-box style=display:none><h3>Thank you for your comment. It will be published in few minutes.</h3><br></div><div id=comment-error style=display:none><h3>An error occurred when submitting the form, please try again.</h3><br></div><div id=commento-mod-tools class=commento-mod-tools style=display:none><button id=commento-mod-tools-lock-button>Lock Thread</button></div><div id=commento-main-area class=commento-main-area><form id=comment-form method=post name=comment-form onsubmit=submitComment(event)><input type=hidden name=options[redirect] value=https://ruddra.com/posts/django-custom-user-migration-mid-phase-project/#comment-submitted>
<input type=hidden name=options[slug] value=django-custom-user-mid-project>
<input type=hidden name=options[parent] value=django-custom-user-mid-project>
<input type=hidden name=options[origin] value=https://ruddra.com/posts/django-custom-user-migration-mid-phase-project/>
<input type=hidden id=comment-parent name=fields[reply_to]>
<input type=hidden name=options[redirectError] value=https://ruddra.com/posts/django-custom-user-migration-mid-phase-project/#comment-error><div id=commento-logged-container class=commento-logged-container><div class=commento-name id=comment-headline><b>Share Your Thoughts</b></div></div><div class=commento-logout></div></div><div id=commento-textarea-super-container-root class=commento-button-margin><div id=commento-textarea-container-root class=commento-textarea-container><textarea name=fields[comment] id=commento-textarea-root placeholder="Add a comment" required></textarea></div><button id=commento-submit-button-root type=submit class="commento-button commento-submit-button submit-github">Comment With Github</button><div class="commento-round-check commento-anonymous-checkbox-container"><input id=commento-anonymous-checkbox-root name=options[subscribe] type=checkbox value=email><label for=commento-anonymous-checkbox-root>Notify me of new comments</label></div><a onclick=toggleMarkDownTable() id=commento-markdown-button-root class=commento-markdown-button><b>M ↓</b> &nbsp; Markdown</a><table id=commento-markdown-help-root class=commento-markdown-help style=display:none><tr><td><i>italics</i></td><td>surround text with<code>*asterisks*</code></td></tr><tr><td><b>bold</b></td><td>surround text with<code>**two asterisks**</code></td></tr><tr><td><a href=https://example.com>hyperlink</a></td><td><code>[hyperlink](https://example.com)</code> or just a bare URL</td></tr><tr><td><code>code</code></td><td>surround text with
<code>`backticks`</code></td></tr><tr><td><code>code block</code></td><td>surround text with
<code>```console.log()```</code></td></tr><tr><td><strike>strikethrough</strike></td><td>surround text with
<code>~~two tilde characters~~</code></td></tr><tr><td><blockquote>quote</blockquote></td><td>prefix with
<code>></code></td></tr></table></div><p id=commneto-renderer-msg></p></form><div id=commento-comments-area class=commento-comments><div id=commento-comment-card-1548007200 style="border-left:2px solid #d9e0d7" class=commento-card><div class=commento-header><div id=commento-comment-options-1548007200 class=commento-options><button id=commento-comment-reply-1548007200 href=#comment-form onclick="changeValue('fields[reply_to]','1548007200','David')" title="Reply to David" class="commento-option-button commento-option-reply onhover" style=right:0></button></div><img src="https://www.gravatar.com/avatar/61c6f1a7784a65ddb8f8f3df4ed9e0d7?s=70&r=pg&d=identicon" class=commento-avatar-img decoding=async loading=lazy alt=David><div id=commento-comment-name-1548007200 class=commento-name>David</div><div id=commento-comment-subtitle-1548007200 class=commento-subtitle><div id=commento-comment-timeago-1548007200 title="Monday, Jan 21, 2019" class=commento-timeago>Monday, Jan 21, 2019</div></div></div><div id=commento-comment-contents-1548007200><div id=commento-comment-body-1548007200 class=commento-body><div id=commento-comment-text-1548007200><p>Thanks i was been struggling with this for some months, maybe you should be more specific with the number 1 of the HardWay of how to create an identical auth.User i just get the code from AbstractUser i just test on my development enviroment and works fine.</p></div></div></div><div><div id=commento-comment-card-1548097200 style="border-left:2px solid #308024" class=commento-card><div class=commento-header><div id=commento-comment-options-1548097200 class=commento-options><button id=commento-comment-reply-1548097200 title="Reply to Arnab Kumar Shil" class="commento-option-button commento-option-reply onhover" style=right:0 href=#comment-form onclick="changeValue('fields[reply_to]','1548007200','Arnab Kumar Shil')"></button></div><img src="https://avatars0.githubusercontent.com/u/3099861?v=4" class=commento-avatar-img><div id=commento-comment-name-1548097200 class="commento-name commento-moderator">Arnab Kumar Shil</div><div id=commento-comment-subtitle-1548097200 class=commento-subtitle><div id=commento-comment-timeago-1548097200 title="Tuesday, Jan 22, 2019" class=commento-timeago>Tuesday, Jan 22, 2019</div></div></div><div id=commento-comment-contents-1548097200><div id=commento-comment-body-1548097200 class=commento-body><div id=commento-comment-text-1548097200><p>Okay, I will update the post accordingly.</p></div></div></div></div></div><script>function changeValue(elementName,newValue,name){document.getElementsByName(elementName)[0].value=newValue;document.getElementById('comment-headline').innerHTML="<b>Reply To: "+name+"</b>";window.location.hash="#comment-form";};</script></div><div id=commento-comment-card-1565546400 style="border-left:2px solid #bfb5d7" class=commento-card><div class=commento-header><div id=commento-comment-options-1565546400 class=commento-options><button id=commento-comment-reply-1565546400 href=#comment-form onclick="changeValue('fields[reply_to]','1565546400','JR177')" title="Reply to JR177" class="commento-option-button commento-option-reply onhover" style=right:0></button></div><img src="https://www.gravatar.com/avatar/caca0257c8924b75cddf052290bfb5d7?s=70&r=pg&d=identicon" class=commento-avatar-img decoding=async loading=lazy alt=JR177><div id=commento-comment-name-1565546400 class=commento-name>JR177</div><div id=commento-comment-subtitle-1565546400 class=commento-subtitle><div id=commento-comment-timeago-1565546400 title="Monday, Aug 12, 2019" class=commento-timeago>Monday, Aug 12, 2019</div></div></div><div id=commento-comment-contents-1565546400><div id=commento-comment-body-1565546400 class=commento-body><div id=commento-comment-text-1565546400><p>Hi Ruddra,
I&rsquo;m struggling with this exact problem. Might you be able to help? <a href=https://stackoverflow.com/questions/57453469/trying-to-extend-base-user-model-mid-project-and-getting-unique-constraint-error>https://stackoverflow.com/questions/57453469/trying-to-extend-base-user-model-mid-project-and-getting-unique-constraint-error</a>.</p></div></div></div><div><div id=commento-comment-card-1565553600 style="border-left:2px solid #bfb5d7" class=commento-card><div class=commento-header><div id=commento-comment-options-1565553600 class=commento-options><button id=commento-comment-reply-1565553600 title="Reply to JR177" class="commento-option-button commento-option-reply onhover" style=right:0 href=#comment-form onclick="changeValue('fields[reply_to]','1565546400','JR177')"></button></div><img src="https://www.gravatar.com/avatar/caca0257c8924b75cddf052290bfb5d7?s=70&r=pg&d=identicon" class=commento-avatar-img><div id=commento-comment-name-1565553600 class=commento-name>JR177</div><div id=commento-comment-subtitle-1565553600 class=commento-subtitle><div id=commento-comment-timeago-1565553600 title="Monday, Aug 12, 2019" class=commento-timeago>Monday, Aug 12, 2019</div></div></div><div id=commento-comment-contents-1565553600><div id=commento-comment-body-1565553600 class=commento-body><div id=commento-comment-text-1565553600><p>I&rsquo;m unsure how to design the &lsquo;views&rsquo; for this solution. My current view saves the form inputs to the default User model and cannot get it to save to the new model. I also hit this &lsquo;uniqueconstraint&rsquo; problem.</p></div></div></div></div></div><script>function changeValue(elementName,newValue,name){document.getElementsByName(elementName)[0].value=newValue;document.getElementById('comment-headline').innerHTML="<b>Reply To: "+name+"</b>";window.location.hash="#comment-form";};</script></div><div id=commento-comment-card-d4615ef0-47e7-11ea-a62f-c13976200e4a style="border-left:2px solid #5d2490" class=commento-card><div class=commento-header><div id=commento-comment-options-d4615ef0-47e7-11ea-a62f-c13976200e4a class=commento-options><button id=commento-comment-reply-d4615ef0-47e7-11ea-a62f-c13976200e4a href=#comment-form onclick="changeValue('fields[reply_to]','d4615ef0-47e7-11ea-a62f-c13976200e4a','Gurubux')" title="Reply to Gurubux" class="commento-option-button commento-option-reply onhover" style=right:0></button></div><img src="https://www.gravatar.com/avatar/d8a900c6a877ceb86524ac83675d2490?s=70&r=pg&d=identicon" class=commento-avatar-img decoding=async loading=lazy alt=Gurubux><div id=commento-comment-name-d4615ef0-47e7-11ea-a62f-c13976200e4a class=commento-name>Gurubux</div><div id=commento-comment-subtitle-d4615ef0-47e7-11ea-a62f-c13976200e4a class=commento-subtitle><div id=commento-comment-timeago-d4615ef0-47e7-11ea-a62f-c13976200e4a title="Wednesday, Feb 5, 2020" class=commento-timeago>Wednesday, Feb 5, 2020</div></div></div><div id=commento-comment-contents-d4615ef0-47e7-11ea-a62f-c13976200e4a><div id=commento-comment-body-d4615ef0-47e7-11ea-a62f-c13976200e4a class=commento-body><div id=commento-comment-text-d4615ef0-47e7-11ea-a62f-c13976200e4a><p>Thank you for this post. My query was that if we drop all the default tables created by Django&rsquo;s makemigration command, will it affect the execution of the API catastrophically or can be managed with those tables. The reason is, those tables are considered to be Junk data. Kindly guide.</p></div></div></div><div><div id=commento-comment-card-f4f47c80-490c-11ea-88e7-339f19dd92a9 style="border-left:2px solid #308024" class=commento-card><div class=commento-header><div id=commento-comment-options-f4f47c80-490c-11ea-88e7-339f19dd92a9 class=commento-options><button id=commento-comment-reply-f4f47c80-490c-11ea-88e7-339f19dd92a9 title="Reply to Ruddra" class="commento-option-button commento-option-reply onhover" style=right:0 href=#comment-form onclick="changeValue('fields[reply_to]','d4615ef0-47e7-11ea-a62f-c13976200e4a','Ruddra')"></button></div><img src="https://avatars0.githubusercontent.com/u/3099861?v=4" class=commento-avatar-img><div id=commento-comment-name-f4f47c80-490c-11ea-88e7-339f19dd92a9 class="commento-name commento-moderator">Ruddra</div><div id=commento-comment-subtitle-f4f47c80-490c-11ea-88e7-339f19dd92a9 class=commento-subtitle><div id=commento-comment-timeago-f4f47c80-490c-11ea-88e7-339f19dd92a9 title="Thursday, Feb 6, 2020" class=commento-timeago>Thursday, Feb 6, 2020</div></div></div><div id=commento-comment-contents-f4f47c80-490c-11ea-88e7-339f19dd92a9><div id=commento-comment-body-f4f47c80-490c-11ea-88e7-339f19dd92a9 class=commento-body><div id=commento-comment-text-f4f47c80-490c-11ea-88e7-339f19dd92a9><p>It shouldn&rsquo;t affect if you are following <a href=https://ruddra.com/posts/django-custom-user-migration-mid-phase-project/#hard-way>this procedure</a>. But before doing anything, please make a backup of your database.</p></div></div></div></div></div><script>function changeValue(elementName,newValue,name){document.getElementsByName(elementName)[0].value=newValue;document.getElementById('comment-headline').innerHTML="<b>Reply To: "+name+"</b>";window.location.hash="#comment-form";};</script></div></div></div></div></div></div><script src=https://ruddra.com/js/bundle.min.2ade8ae77a40b0c9116025b3b42cb1d0ba78889d8e5ed75e490d90092602536c.js async></script></div></div><label for=sidebar-checkbox class=sidebar-toggle></label><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-58095062-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body><script>function showPrivacy(){if(localStorage.getItem("cookieSeen")!="shown"){var x=document.getElementById("snackbar");x.className="show";localStorage.setItem("cookieSeen","shown")}}
showPrivacy();function closePrivacy(){var fadeTarget=document.getElementById("snackbar");var fadeEffect=setInterval(function(){if(!fadeTarget.style.opacity){fadeTarget.style.opacity=1;}
if(fadeTarget.style.opacity>0){fadeTarget.style.opacity-=0.1;}else{clearInterval(fadeEffect);}},50);}
document.getElementById("close-privacy").addEventListener('click',closePrivacy);</script></html>